<input ref:input type="date" />

<script>
import flatpickr from 'flatpickr';

const hooks = new Set([
	'onChange',
	'onOpen',
	'onClose',
	'onMonthChange',
	'onYearChange',
	'onReady',
	'onValueUpdate',
	'onDayCreate'
]);

export default {
	data() {
		return {
			options: {

			}
		};
	},

	oncreate() {
		this.fp = flatpickr(this.refs.input, this.addHooks(this.get('options')));

		this.observe('options', options => {
			options = this.addHooks(options);

			for (let [key, val] in Object.entries(options)) {
				this.fp.set(key, val);
			}
		});
	},

	methods: {
		addHooks(options) {
			options = Object.assign({}, options);

			for (let hook of hooks) {
				let firer = (selectedDates, dateStr, instance) => {
					this.fire(stripOn(hook), [selectedDates, dateStr, instance]);
				};

				if (hook in options) {
					// Hooks must be arrays
					if (!Array.isArray(options[hook]))
						options[hook] = [options[hook]];

					options[hook].push(firer);
				} else {
					options[hook] = [firer];
				}
			}

			return options;
		}
	},

	ondestroy() {
		if (this.fp && 'destroy' in this.fp)
			this.fp.destroy();
	}
};

function stripOn(hook) {
	return hook.charAt(2).toLowerCase() + hook.substring(3);
};
</script>
